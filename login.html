<!DOCTYPE html>
<html lang="id" data-theme="dark">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Login — Perpustakaan Digital</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Varela+Round&display=swap" rel="stylesheet">

  <style>
    :root {
      --glass-bg: rgba(255, 255, 255, .10);
      --glass-br: 16px;
      --glass-bd: 1px solid rgba(255, 255, 255, .22);
      --text: #f8fafc;
      --muted: #cbd5e1;
      --accent: #22d3ee;
      --accent-2: #6366f1;
      --field-bg: rgba(255, 255, 255, .12);
      --field-bd: rgba(255, 255, 255, .22);
      --shadow: 0 10px 50px rgba(0, 0, 0, .35);
      --body-bg: radial-gradient(1200px 800px at 70% 10%, rgba(255, 255, 255, .08), transparent),
        linear-gradient(135deg, #0b1024 0%, #0e1634 35%, #0a1230 100%);
    }

    [data-theme="light"] {
      --glass-bg: rgba(255, 255, 255, .8);
      --glass-br: 18px;
      --glass-bd: 1px solid rgba(0, 0, 0, .06);
      --text: #111827;
      --muted: #6b7280;
      --accent: #2563eb;
      --accent-2: #06b6d4;
      --field-bg: #fff;
      --field-bd: rgba(0, 0, 0, .12);
      --shadow: 0 24px 60px rgba(0, 0, 0, .12);
      --body-bg:
        radial-gradient(1000px 600px at 20% -10%, rgba(99, 102, 241, .08), transparent 60%),
        radial-gradient(1000px 600px at 80% 110%, rgba(34, 211, 238, .08), transparent 60%),
        linear-gradient(180deg, #f5f7fb, #eef2f7);
    }

    html,
    body {
      height: 100%
    }

    body {
      font-family: 'Varela Round', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      margin: 0;
      overflow: hidden;
      color: var(--text);
      background: var(--body-bg);
    }

    canvas#stars,
    canvas#stars2 {
      position: fixed;
      inset: 0;
      z-index: 0;
      display: block;
    }

    .login-wrap {
      position: relative;
      z-index: 2;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }

    .login-card {
      width: 100%;
      max-width: 460px;
      border-radius: 16px;
      background: var(--glass-bg);
      border: var(--glass-bd);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      padding: 28px 24px;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
      justify-content: center;
      margin-bottom: 16px;
    }

    .brand .logo {
      width: 46px;
      height: 46px;
      display: grid;
      place-items: center;
      border-radius: 12px;
      color: #fff;
      background: linear-gradient(135deg, var(--accent), var(--accent-2));
      box-shadow: 0 8px 24px rgba(99, 102, 241, .35);
    }

    .brand h2 {
      margin: 0;
      font-weight: 800;
      letter-spacing: .02em;
    }

    .form-label {
      color: var(--muted);
    }

    .form-control {
      background: var(--field-bg);
      border: 1px solid var(--field-bd);
      color: var(--text);
    }

    .form-control::placeholder {
      color: #9ca3af;
    }

    .form-control:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 .2rem color-mix(in srgb, var(--accent) 25%, transparent);
      background: var(--field-bg);
      color: var(--text);
    }

    .input-group .btn-eye {
      border-color: var(--field-bd);
      border-left: 0;
    }

    .input-group .form-control+.btn-eye {
      border-left: 1px solid var(--field-bd);
    }

    .btn-eye i {
      pointer-events: none;
    }

    .btn-primary {
      background: linear-gradient(90deg, var(--accent), var(--accent-2));
      border: 0;
      transition: transform .15s ease, box-shadow .2s ease;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(99, 102, 241, .25);
    }

    .top-actions {
      position: fixed;
      z-index: 3;
      top: 14px;
      right: 14px;
      display: flex;
      gap: 8px;
    }

    .hint {
      font-size: .85rem;
      color: var(--muted);
    }

    .toast-container {
      z-index: 9999;
    }

    a {
      color: var(--accent);
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }
  </style>
</head>

<body>

  <canvas id="stars"></canvas>
  <canvas id="stars2"></canvas>

  <div class="top-actions">
    <button id="themeToggle" class="btn btn-sm btn-outline-light" title="Light/Dark">
      <i class="bi bi-brightness-high"></i>
    </button>
  </div>

  <div class="login-wrap">
    <div class="login-card">
      <div class="brand">
        <div class="logo"><i class="bi bi-stars"></i></div>
        <h2>Masuk Akun</h2>
      </div>

      <div id="warningAlert" class="alert alert-danger d-none" role="alert">
        <i class="bi bi-exclamation-triangle-fill me-2"></i>
        <span id="warningMessage"></span>
      </div>

      <!-- PENTING: action + method + name pada input & tombol -->
      <form id="loginForm" action="login.php" method="post" novalidate>
        <div class="mb-3">
          <label class="form-label" for="email">Email</label>
          <input type="email" id="email" name="email" class="form-control" placeholder="nama@domain.com"
            autocomplete="username" required>
        </div>

        <div class="mb-2">
          <label class="form-label" for="password">Password</label>
          <div class="input-group">
            <input type="password" id="password" name="password" class="form-control" placeholder="Minimal 6 karakter"
              autocomplete="current-password" required>
            <button class="btn btn-outline-secondary btn-eye" type="button" id="togglePassword"
              aria-label="Tampilkan/Sembunyikan">
              <i class="bi bi-eye-slash"></i>
            </button>
          </div>
          <div id="capsHint" class="hint mt-1 d-none"><i class="bi bi-shift"></i> Caps Lock aktif</div>
        </div>

        <div class="mb-3">
          <div class="progress" style="height:6px;border-radius:999px;background:rgba(0,0,0,.08);">
            <div id="strengthBar" class="progress-bar" style="width:0%"></div>
          </div>
          <div class="d-flex justify-content-between">
            <small id="strengthText" class="hint">Kekuatan sandi: —</small>
            <small class="hint"></small>
          </div>
        </div>

        <div class="d-flex justify-content-between align-items-center mb-3">
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="rememberMe">
            <label class="form-check-label" for="rememberMe">Ingat saya</label>
          </div>
          <a href="#" id="forgotLink">Lupa password?</a>
        </div>

        <div class="d-grid">
          <button type="submit" id="loginBtn" name="login" class="btn btn-primary">
            <i class="bi bi-box-arrow-in-right me-1"></i> Login
          </button>
        </div>

        <p class="text-center mt-3 mb-0" style="color:var(--muted)">
          Belum punya akun? <a href="form_register.html" class="fw-bold">Register</a>
        </p>
      </form>
    </div>
  </div>

  <div class="toast-container position-fixed top-0 start-50 translate-middle-x p-3">
    <div id="serverToast" class="toast align-items-center text-bg-danger border-0" role="alert" aria-live="assertive"
      aria-atomic="true">
      <div class="d-flex">
        <div class="toast-body"><i class="bi bi-x-circle me-2"></i><span id="serverToastMsg">Email atau password
            salah.</span></div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"
          aria-label="Close"></button>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    /* ================= Theme Toggle ================= */
    const themeBtn = document.getElementById('themeToggle');
    (function syncTheme() {
      const saved = localStorage.getItem('theme') || 'dark';
      document.documentElement.setAttribute('data-theme', saved);
      themeBtn.classList.toggle('btn-outline-dark', saved === 'light');
      themeBtn.classList.toggle('btn-outline-light', saved !== 'light');
    })();
    themeBtn.addEventListener('click', () => {
      const cur = document.documentElement.getAttribute('data-theme') || 'dark';
      const next = (cur === 'dark') ? 'light' : 'dark';
      document.documentElement.setAttribute('data-theme', next);
      localStorage.setItem('theme', next);
      themeBtn.classList.toggle('btn-outline-dark', next === 'light');
      themeBtn.classList.toggle('btn-outline-light', next !== 'light');
    });

    /* ================= Canvas Stars (dua layer) ================= */
    const c1 = document.getElementById('stars'); const ctx1 = c1.getContext('2d');
    const c2 = document.getElementById('stars2'); const ctx2 = c2.getContext('2d');
    function fitCanvas() { [c1, c2].forEach(c => { c.width = innerWidth; c.height = innerHeight; }); }
    window.addEventListener('resize', fitCanvas); fitCanvas();
    function createStars(n, speedMin, speedMax, sizeMin, sizeMax) {
      const arr = []; for (let i = 0; i < n; i++) arr.push({
        x: Math.random() * c1.width, y: Math.random() * c1.height,
        r: sizeMin + Math.random() * (sizeMax - sizeMin),
        v: speedMin + Math.random() * (speedMax - speedMin),
        tw: Math.random() * Math.PI * 2
      }); return arr;
    }
    const stars1 = createStars(120, .002, .01, 0.6, 1.6);
    const stars2 = createStars(60, .004, .015, 1.0, 2.2);
    function drawLayer(ctx, stars) {
      ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
      const isLight = document.documentElement.getAttribute('data-theme') === 'light';
      for (const s of stars) {
        s.tw += s.v; const op = (isLight ? .25 : .4) + Math.sin(s.tw) * (isLight ? .25 : .4);
        ctx.beginPath(); ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
        ctx.fillStyle = `rgba(255,255,255,${Math.max(0, Math.min(1, op)).toFixed(2)})`;
        ctx.fill();
      }
    }
    (function loop() { drawLayer(ctx1, stars1); drawLayer(ctx2, stars2); requestAnimationFrame(loop); })();

    /* ================= Form & Validasi ringkas (tanpa preventDefault) ================= */
    const loginForm = document.getElementById('loginForm');
    const emailEl = document.getElementById('email');
    const passEl = document.getElementById('password');
    const togglePass = document.getElementById('togglePassword');
    const loginBtn = document.getElementById('loginBtn');
    const alertBox = document.getElementById('warningAlert');
    const alertMsg = document.getElementById('warningMessage');
    const rememberMe = document.getElementById('rememberMe');
    const capsHint = document.getElementById('capsHint');

    function showClientAlert(msg, type = 'danger') {
      alertMsg.innerHTML = msg;
      alertBox.classList.remove('d-none');
      alertBox.classList.toggle('alert-danger', type === 'danger');
      alertBox.classList.toggle('alert-warning', type === 'warning');
    }

    /* Ingat saya */
    (function restoreRemember() {
      const savedEmail = localStorage.getItem('remember_email');
      if (savedEmail) { emailEl.value = savedEmail; rememberMe.checked = true; }
    })();
    rememberMe.addEventListener('change', () => {
      if (rememberMe.checked) localStorage.setItem('remember_email', emailEl.value || '');
      else localStorage.removeItem('remember_email');
    });
    emailEl.addEventListener('input', () => {
      if (rememberMe.checked) localStorage.setItem('remember_email', emailEl.value || '');
    });

    /* Toggle password */
    togglePass.addEventListener('click', () => {
      const isHidden = passEl.type === 'password';
      passEl.type = isHidden ? 'text' : 'password';
      togglePass.querySelector('i').classList.toggle('bi-eye', isHidden);
      togglePass.querySelector('i').classList.toggle('bi-eye-slash', !isHidden);
    });

    /* Caps Lock hint */
    ['keydown', 'keyup'].forEach(ev => {
      passEl.addEventListener(ev, (e) => {
        const caps = e.getModifierState && e.getModifierState('CapsLock');
        capsHint.classList.toggle('d-none', !caps);
      });
    });

    /* Strength meter sederhana */
    const strengthBar = document.getElementById('strengthBar');
    const strengthText = document.getElementById('strengthText');
    passEl.addEventListener('input', () => {
      const v = passEl.value;
      let score = 0;
      if (v.length >= 6) score++;
      if (/[A-Z]/.test(v)) score++;
      if (/[a-z]/.test(v)) score++;
      if (/[0-9]/.test(v)) score++;
      if (/[^A-Za-z0-9]/.test(v)) score++;
      const pct = Math.min(100, score * 20);
      strengthBar.style.width = pct + '%';
      strengthBar.className = 'progress-bar';
      if (score <= 2) { strengthBar.classList.add('bg-danger'); strengthText.textContent = 'Kekuatan sandi: Lemah'; }
      else if (score === 3) { strengthBar.classList.add('bg-warning'); strengthText.textContent = 'Kekuatan sandi: Sedang'; }
      else { strengthBar.classList.add('bg-success'); strengthText.textContent = 'Kekuatan sandi: Kuat'; }
    });

    /* SUBMIT → biarkan ke server, cuma kasih spinner + validasi ringan */
    loginForm.addEventListener('submit', (e) => {
      alertBox.classList.add('d-none');
      alertMsg.textContent = '';

      const email = emailEl.value.trim();
      const pass = passEl.value;
      let message = "";
      if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) message = "Format email tidak valid!";
      else if (pass.length < 6) message = "Password minimal 6 karakter!";

      if (message) {
        e.preventDefault();
        showClientAlert(message);
        return;
      }

      loginBtn.disabled = true;
      loginBtn.innerHTML = `<span class="spinner-border spinner-border-sm me-1"></span> Memproses...`;
      // TIDAK preventDefault → submit ke login.php
    });

    /* Toast helper (dipakai kalau kamu mau pakai ?error= di URL dan tampilin toast) */
    function showToast(msg) {
      const toastEl = document.getElementById('serverToast');
      document.getElementById('serverToastMsg').textContent = msg;
      new bootstrap.Toast(toastEl).show();
    }
  </script>
</body>

</html>