<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<title>‚è∞ Waktu Membaca Tidak Dianjurkan</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<style>
  :root{
    --card-max: 780px;
    --night: #6a5acd;
    --dawn:  #34d399;
    --accent-1: #ff9a9e;
    --accent-2: #fad0c4;
  }
  *{ box-sizing: border-box; }

  /* ===== Background linear gradient + animasi halus ===== */
  body{
    position: relative;
    font-family: system-ui, -apple-system, "Poppins", Segoe UI, Roboto, Arial, sans-serif;
    min-height: 100vh; margin: 0; color: #fff;
    text-align: center; padding: 24px 20px;
    display: flex; flex-direction: column; justify-content: center;
    background: linear-gradient(135deg,#14182b,#1a1a2e,#243b55,#14182b);
    background-size: 400% 400%;
    animation: gradientShift 18s ease-in-out infinite alternate;
    overflow-x: hidden;
  }
  @keyframes gradientShift{
    0%{ background-position: 0% 50%; }
    50%{ background-position: 50% 100%; }
    100%{ background-position: 100% 50%; }
  }
  @media (prefers-reduced-motion: reduce){ body{ animation:none; } }

  /* ===== Layout: info card kiri + tombol fitur kanan ===== */
  .page-wrap{
    display: grid;
    grid-template-columns: 1fr; gap: 16px; align-items: center;
  }
  @media (min-width: 992px){
    .page-wrap{ grid-template-columns: 1fr auto; }
  }

  /* Card informasi saja */
  .card-info{
    position: relative; z-index: 2;
    background: rgba(0,0,0,0.72);
    border: 1px solid rgba(255,255,255,0.12);
    border-radius: 18px; padding: 24px; max-width: var(--card-max); margin: auto;
    box-shadow: 0 10px 30px rgba(0,0,0,0.55); backdrop-filter: blur(6px);
  }
  .card-info, .card-info *{ color: #fff !important; }
  .card-info img{
    display:block; margin: 0 auto 12px; width: 104px; height: 104px; object-fit: contain;
    animation: float 3s ease-in-out infinite; filter: drop-shadow(0 6px 12px rgba(0,0,0,.35));
  }
  @keyframes float{ 0%{transform:translateY(0)} 50%{transform:translateY(-8px)} 100%{transform:translateY(0)} }
  @media (prefers-reduced-motion: reduce){ .card-info img{ animation:none; } }

  #clock{ font-size: 1.1rem; font-weight: 700; color: #ffcc70 !important; margin-bottom: 6px; text-shadow: 0 1px 3px rgba(0,0,0,.8); }
  #openStatus{ font-size: .98rem; opacity: .96; text-shadow: 0 1px 3px rgba(0,0,0,.8); }

  .info-box{
    background: rgba(255,255,255,0.06);
    border: 1px solid rgba(255,255,255,0.12);
    padding: 12px 14px; border-radius: 12px;
  }
  .carousel-item{ padding: 4px; }

  .schedule-box{
    display: grid; gap: 6px; place-items: center; text-align: center;
  }
  .badge-soft{
    display:inline-block; padding:.35rem .7rem; border-radius:999px;
    background: rgba(255,255,255,.12); border:1px solid rgba(255,255,255,.2);
    font-size:.85rem;
  }

  /* Progress ‚Äúmendekati 07:00‚Äù */
  .progress{ height: 20px; background: rgba(255,255,255,0.18); border-radius: 10px; overflow: hidden; }
  .progress-bar{
    transition: width .6s ease, background-color .6s ease, background .6s ease;
    background: linear-gradient(90deg, var(--night), var(--dawn));
    background-size: 200% 100%;
    animation: barShimmer 4s linear infinite;
  }
  @keyframes barShimmer{ from{ background-position: 0 0; } to{ background-position: 200% 0; } }

  /* Persetujuan */
  #agreeCheckbox{ transform: scale(1.1); margin-right: 8px; }
  .btn-lg{ padding: 10px 22px; font-size: 18px; border-radius: 28px; }
  a, .btn{ color: #fff; }

  /* ===== Tombol fitur melayang ===== */
  .fab-col{
    position: fixed;
    z-index: 3;
    display: flex; gap: 12px;
  }
  @media (min-width: 992px){
    .fab-col{ right: 20px; top: 50%; transform: translateY(-50%); flex-direction: column; align-items: flex-end; }
  }
  @media (max-width: 991.98px){
    .fab-col{
      right: max(16px, env(safe-area-inset-right));
      bottom: max(16px, env(safe-area-inset-bottom));
      flex-direction: row; align-items: flex-end;
    }
  }
  .fab{
    display: inline-flex; align-items: center; gap: 10px;
    background: rgba(0,0,0,.6);
    border: 1px solid rgba(255,255,255,.18);
    color: #fff; padding: 10px 14px; border-radius: 999px;
    box-shadow: 0 8px 18px rgba(0,0,0,.35);
    backdrop-filter: blur(8px);
    cursor: pointer; text-decoration: none;
    transition: transform .15s ease, background .2s ease, box-shadow .2s ease;
  }
  .fab:hover{ transform: translateY(-2px); background: rgba(0,0,0,.7); }
  .fab i{ font-size: 1rem; }
  @media (max-width: 991.98px){
    .fab span{ display:none; }
    .fab{ padding: 12px; width: 48px; height: 48px; justify-content: center; }
  }

  /* ===== Modal pop-up cards (fitur) ===== */
  .modal-content{
    background: rgba(0,0,0,.82);
    border: 1px solid rgba(255,255,255,.15);
    color: #fff;
    backdrop-filter: blur(10px);
    border-radius: 16px;
  }
  .form-range{ accent-color: #ffcc70; }

  /* Nudge audio */
  .audio-nudge{
    position: fixed; left: 50%; bottom: max(18px, env(safe-area-inset-bottom));
    transform: translateX(-50%);
    z-index: 4; background: rgba(0,0,0,.7); color:#fff; border:1px solid rgba(255,255,255,.2);
    border-radius: 999px; padding: 10px 14px; display: none; gap:8px; align-items:center;
    backdrop-filter: blur(6px);
  }
  .audio-nudge.show{ display: inline-flex; }

  footer{ margin-top: 16px; font-size: 13px; opacity: .95; position: relative; z-index: 2; }

  /* ====== OVERLAY COUNTDOWN 10‚Üí1 ====== */
  .countdown-overlay{
    position: fixed; inset: 0; z-index: 9999;
    display: grid; place-items: center;
    background: radial-gradient(1200px 800px at 50% 40%, rgba(255,255,255,0.06), rgba(0,0,0,0.85) 60%, rgba(0,0,0,0.95));
    backdrop-filter: blur(4px);
  }
  .count-num{
    font-size: clamp(64px, 14vw, 220px);
    font-weight: 800;
    letter-spacing: .02em;
    line-height: 1;
    color: #fff;
    text-shadow: 0 10px 30px rgba(0,0,0,.6);
    animation: pop 600ms ease;
    will-change: transform, opacity;
  }
  @keyframes pop{
    0%{ transform: scale(.7); opacity: .2; }
    60%{ transform: scale(1.08); opacity: 1; }
    100%{ transform: scale(1); }
  }
  @media (prefers-reduced-motion: reduce){
    .count-num{ animation: none; }
  }
  .count-sub{
    margin-top: .5rem;
    font-size: clamp(14px, 3.5vw, 22px);
    opacity: .85;
  }
</style>
</head>
<body>

<div class="page-wrap">
  <!-- KIRI: CARD INFORMASI SAJA -->
  <div>
    <div id="clock"></div>
    <div id="openStatus"></div>

    <div class="card-info">
      <img src="https://cdn-icons-png.flaticon.com/512/616/616408.png" alt="Bahaya Membaca Malam" />
      <h1 class="mb-1">‚è∞ Waktu Membaca Tidak Dianjurkan</h1>
      <p class="mb-2">Sekarang sudah lewat jam yang direkomendasikan untuk membaca buku digital.</p>

      <!-- Jadwal (center) -->
      <div class="info-box schedule-box mb-3">
        <div><span class="badge-soft">Jam buka: 07:00 ‚Äì 21:00 WIB</span></div>
        <div class="mt-1">Buka lagi dalam: <strong id="countdown">‚Äî</strong></div>
      </div>

      <!-- Tips -->
      <div id="tipsCarousel" class="carousel slide mb-3 info-box" data-bs-ride="carousel" data-bs-interval="3400">
        <div class="carousel-inner">
          <div class="carousel-item active">üëÅÔ∏è Jangan membaca lebih dari 2 jam tanpa istirahat.</div>
          <div class="carousel-item">üß† Tidur cukup minimal 7 jam per hari.</div>
          <div class="carousel-item">üí° Gunakan pencahayaan ruangan yang cukup saat membaca.</div>
          <div class="carousel-item">üí§ Hindari layar gadget 30 menit sebelum tidur.</div>
          <div class="carousel-item">üï∂Ô∏è Gunakan mode redup & hangat saat malam.</div>
        </div>
      </div>

      <!-- Progress menuju 07:00 WIB -->
      <p class="mb-1">Waktu aman membaca hari ini sudah habis</p>
      <div class="progress mb-3">
        <div id="dawnBar" class="progress-bar progress-bar-striped progress-bar-animated" style="width:100%"></div>
      </div>

      <!-- Persetujuan ‚Üí hanya untuk tombol lanjut -->
      <div class="form-check text-start my-3">
        <input class="form-check-input" type="checkbox" id="agreeCheckbox">
        <label class="form-check-label" for="agreeCheckbox">Saya menyadari risiko dan tetap ingin melanjutkan</label>
      </div>

      <a id="continueBtn" href="continue.php" class="btn btn-warning btn-lg disabled" tabindex="-1" aria-disabled="true">
        Lanjut ke Halaman üìö
      </a>

      <p class="mt-3"><i>Jam buka normal: 07:00 - 21:00 WIB</i></p>
    </div>

    <footer>Dibuat dengan ‚ù§Ô∏è oleh Perpustakaan Digital</footer>
  </div>

  <!-- KANAN: TOMBOL FITUR MELAYANG -->
  <div class="fab-col">
    <a class="fab" data-bs-toggle="modal" data-bs-target="#eyeComfortModal" aria-label="Kenyamanan Mata">
      <i class="fa-solid fa-eye"></i><span>Kenyamanan Mata</span>
    </a>
    <a class="fab" data-bs-toggle="modal" data-bs-target="#textSizeModal" aria-label="Ukuran Teks">
      <i class="fa-solid fa-text-height"></i><span>Ukuran Teks</span>
    </a>
    <a class="fab" data-bs-toggle="modal" data-bs-target="#audioModal" aria-label="Audio">
      <i class="fa-solid fa-volume-high"></i><span>Audio</span>
    </a>
  </div>
</div>

<!-- ===== MODALS ===== -->
<div class="modal fade" id="eyeComfortModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered"><div class="modal-content">
    <div class="modal-header">
      <h5 class="modal-title"><i class="fa-solid fa-eye me-2"></i>Kenyamanan Mata</h5>
      <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
    </div>
    <div class="modal-body">
      <div class="d-flex align-items-center justify-content-between mb-2">
        <span>Status</span><span id="eyeStatus" class="badge-soft">Off</span>
      </div>
      <div class="form-check mb-1">
        <input class="form-check-input" type="checkbox" id="toggleDim">
        <label class="form-check-label" for="toggleDim">Redupkan layar (overlay)</label>
      </div>
      <div class="form-check">
        <input class="form-check-input" type="checkbox" id="toggleWarm">
        <label class="form-check-label" for="toggleWarm">Hangatkan warna (anti-silau)</label>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-outline-light" data-bs-dismiss="modal">Tutup</button>
    </div>
  </div></div>
</div>

<div class="modal fade" id="textSizeModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered"><div class="modal-content">
    <div class="modal-header">
      <h5 class="modal-title"><i class="fa-solid fa-text-height me-2"></i>Ukuran Teks</h5>
      <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
    </div>
    <div class="modal-body">
      <label class="form-label">Atur kenyamanan membaca (90‚Äì120%)</label>
      <input type="range" id="fontSizeRange" class="form-range" min="90" max="120" step="2" value="100" />
    </div>
    <div class="modal-footer">
      <button class="btn btn-outline-light" data-bs-dismiss="modal">Selesai</button>
    </div>
  </div></div>
</div>

<div class="modal fade" id="audioModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered"><div class="modal-content">
    <div class="modal-header">
      <h5 class="modal-title"><i class="fa-solid fa-volume-high me-2"></i>Audio</h5>
      <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
    </div>
    <div class="modal-body">
      <div class="d-flex align-items-center gap-2 mb-2">
        <button id="muteBtn" class="btn btn-sm btn-outline-light">
          <i class="fa-solid fa-volume-xmark"></i> Mute
        </button>
        <input type="range" id="volRange" class="form-range" min="0" max="1" step="0.01" value="0.25" style="max-width:240px;">
      </div>
      <small>Musik diputar otomatis saat halaman dibuka (tergantung kebijakan browser).</small>
    </div>
    <div class="modal-footer">
      <button class="btn btn-outline-light" data-bs-dismiss="modal">Tutup</button>
    </div>
  </div></div>
</div>

<!-- Layers kenyamanan mata -->
<div id="eyeDim" class="eye-dim-layer" aria-hidden="true"></div>
<div id="warmTone" class="warm-tone" aria-hidden="true"></div>

<!-- Audio -->
<audio id="bgMusic" loop preload="auto" playsinline>
  <source src="https://www.myinstants.com/media/sounds/musique-dascenseur-mp3cut.mp3" type="audio/mpeg">
</audio>

<!-- Nudge autoplay -->
<div id="audioNudge" class="audio-nudge">
  <span><i class="fa-solid fa-music"></i> Ketuk untuk mengaktifkan audio</span>
  <button id="nudgePlay" class="btn btn-sm btn-primary">Putar</button>
</div>

<!-- ===== OVERLAY COUNTDOWN (auto) ===== -->
<div id="countdownOverlay" class="countdown-overlay" role="dialog" aria-live="assertive" aria-label="Pengalihan halaman">
  <div>
    <div id="countNum" class="count-num">10</div>
    <div class="count-sub">Mengalihkan ke halaman login‚Ä¶</div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
  const $ = (s)=>document.querySelector(s);

  const clock      = $('#clock');
  const openStatus = $('#openStatus');
  const dawnBar    = $('#dawnBar');
  const countdown  = $('#countdown');

  const checkbox   = $('#agreeCheckbox');
  const btn        = $('#continueBtn');

  const audio      = $('#bgMusic');
  const muteBtn    = $('#muteBtn');
  const volRange   = $('#volRange');
  const audioNudge = $('#audioNudge');
  const nudgePlay  = $('#nudgePlay');

  const eyeDim     = $('#eyeDim');
  const warmTone   = $('#warmTone');
  const toggleDim  = $('#toggleDim');
  const toggleWarm = $('#toggleWarm');
  const eyeStatus  = $('#eyeStatus');
  const fontSizeRange = $('#fontSizeRange');

  /* ===== Jam, status, progress ke 07:00 ===== */
  function updateClock(){
    const now = new Date();
    clock.textContent = now.toLocaleString('id-ID', {
      weekday:'short', year:'numeric', month:'short', day:'2-digit',
      hour:'2-digit', minute:'2-digit', second:'2-digit'
    });
    updateOpenStatusAndDawnBar(now);
  }
  setInterval(updateClock, 1000); updateClock();

  function updateOpenStatusAndDawnBar(now){
    const start = new Date(now); start.setHours(7,0,0,0);
    const end   = new Date(now); end.setHours(21,0,0,0);
    const isOpen = now >= start && now < end;
    openStatus.innerHTML = isOpen
      ? "<span class='badge-soft'><i class='fa-solid fa-unlock'></i> Sedang <b>BUKA</b></span>"
      : "<span class='badge-soft'><i class='fa-solid fa-lock'></i> Sedang <b>TUTUP</b></span>";

    let target;
    if(now < start){ target = start; }
    else{ target = new Date(now.getFullYear(), now.getMonth(), now.getDate()+1, 7,0,0,0); }

    const totalNightMs = 10 * 60 * 60 * 1000;
    const lastNightStart = new Date(now);
    if(now.getHours() >= 21){ lastNightStart.setHours(21,0,0,0); }
    else{ lastNightStart.setDate(lastNightStart.getDate()-1); lastNightStart.setHours(21,0,0,0); }

    const elapsed = Math.max(0, now - lastNightStart);
    const clamped = Math.min(totalNightMs, elapsed);
    const t = clamped / totalNightMs;

    const night = hexToRgb(getComputedStyle(document.documentElement).getPropertyValue('--night').trim());
    const dawn  = hexToRgb(getComputedStyle(document.documentElement).getPropertyValue('--dawn').trim());
    const mix   = {
      r: Math.round(night.r + (dawn.r - night.r) * t),
      g: Math.round(night.g + (dawn.g - night.g) * t),
      b: Math.round(night.b + (dawn.b - night.b) * t)
    };
    const mixed = `rgb(${mix.r},${mix.g},${mix.b})`;
    dawnBar.style.background = `linear-gradient(90deg, ${mixed}, #ffffff33)`;

    if(countdown){
      const diff = Math.max(0, target - now);
      const h = Math.floor(diff/3_600_000);
      const m = Math.floor((diff%3_600_000)/60_000);
      const s = Math.floor((diff%60_000)/1000);
      countdown.textContent = `${String(h).padStart(2,'0')}j ${String(m).padStart(2,'0')}m ${String(s).padStart(2,'0')}d`;
    }
  }
  function hexToRgb(hex){
    const h = hex.replace('#','').trim();
    const bigint = parseInt(h, 16);
    return { r:(bigint>>16)&255, g:(bigint>>8)&255, b:bigint&255 };
  }

  /* ===== Persetujuan tombol lanjut ===== */
  checkbox.addEventListener('change', ()=>{
    const on = checkbox.checked;
    btn.classList.toggle('disabled', !on);
    btn.setAttribute('aria-disabled', String(!on));
    if(on) btn.focus();
  });

  /* ===== Autoplay musik dengan fallback ===== */
  async function tryAutoplay(){
    const savedVol = Number(localStorage.getItem('reader_vol') ?? 0.25);
    try{
      audio.muted = false; audio.volume = savedVol;
      await audio.play();
      audioNudge.classList.remove('show');
    }catch(e){
      try{
        audio.muted = true; audio.volume = 0;
        await audio.play();
        showNudgeAndUnlock(savedVol);
      }catch(err){
        audioNudge.classList.add('show');
        nudgePlay.addEventListener('click', ()=>{
          audio.muted = false; audio.volume = savedVol;
          audio.play().catch(()=>{}); audioNudge.classList.remove('show');
        }, {once:true});
      }
    }
  }
  function showNudgeAndUnlock(targetVol){
    audioNudge.classList.add('show');
    const unlock = ()=>{
      audio.muted = false;
      fadeVolume(audio, 0, targetVol, 600);
      audioNudge.classList.remove('show');
      removeUnlockListeners();
    };
    const removeUnlockListeners = ()=>{
      window.removeEventListener('click', unlock);
      window.removeEventListener('touchstart', unlock);
      window.removeEventListener('keydown', unlock);
      window.removeEventListener('mousemove', unlock);
      document.removeEventListener('visibilitychange', visHandler);
      nudgePlay.removeEventListener('click', unlock);
    };
    const visHandler = ()=>{ if(!document.hidden) unlock(); };
    window.addEventListener('click', unlock, { once: true });
    window.addEventListener('touchstart', unlock, { once: true });
    window.addEventListener('keydown', unlock, { once: true });
    window.addEventListener('mousemove', unlock, { once: true });
    document.addEventListener('visibilitychange', visHandler, { once: true });
    nudgePlay.addEventListener('click', unlock, { once: true });
  }
  function fadeVolume(el, from, to, duration, done){
    const start = performance.now();
    function step(t){
      const p = Math.min(1, (t - start)/duration);
      el.volume = from + (to - from)*p;
      if(p < 1) requestAnimationFrame(step); else if(done) done();
    }
    requestAnimationFrame(step);
  }
  tryAutoplay();

  // Kontrol audio (modal)
  function isMuted(){ return audio.muted || audio.volume===0; }
  muteBtn.addEventListener('click', ()=>{
    if(isMuted()){
      audio.muted = false;
      const v = Number(localStorage.getItem('reader_vol') ?? 0.25);
      audio.volume = v; muteBtn.innerHTML = "<i class='fa-solid fa-volume-xmark'></i> Mute";
    }else{
      audio.muted = true; muteBtn.innerHTML = "<i class='fa-solid fa-volume-high'></i> Unmute";
    }
  });
  volRange.addEventListener('input', ()=>{
    localStorage.setItem('reader_vol', volRange.value);
    if(!audio.muted) audio.volume = Number(volRange.value);
  });

  // Preferensi kenyamanan mata & ukuran teks
  const prefs = JSON.parse(localStorage.getItem('reader_prefs')||'{}');
  if(prefs.dim){ toggleDim.checked = true; eyeDim.classList.add('active'); }
  if(prefs.warm){ toggleWarm.checked = true; warmTone.classList.add('active'); }
  if(prefs.fontPct){ fontSizeRange.value = prefs.fontPct; document.documentElement.style.fontSize = prefs.fontPct+'%'; }
  updateEyeBadge();

  toggleDim?.addEventListener('change', ()=>{
    eyeDim.classList.toggle('active', toggleDim.checked);
    savePrefs(); updateEyeBadge();
  });
  toggleWarm?.addEventListener('change', ()=>{
    warmTone.classList.toggle('active', toggleWarm.checked);
    savePrefs(); updateEyeBadge();
  });
  fontSizeRange?.addEventListener('input', ()=>{
    document.documentElement.style.fontSize = fontSizeRange.value+'%';
  });
  fontSizeRange?.addEventListener('change', savePrefs);

  function updateEyeBadge(){
    if(!eyeStatus) return;
    const on = (toggleDim?.checked || toggleWarm?.checked);
    eyeStatus.textContent = on ? 'On' : 'Off';
  }
  function savePrefs(){
    localStorage.setItem('reader_prefs', JSON.stringify({
      dim: toggleDim?.checked,
      warm: toggleWarm?.checked,
      fontPct: fontSizeRange?.value
    }));
  }

  // ===== BIG COUNTDOWN 10 ‚Üí 1 lalu redirect =====
  (function startBigCountdown(){
    const overlay = document.getElementById('countdownOverlay');
    const numEl   = document.getElementById('countNum');
    let n = 10;
    numEl.textContent = n;

    const tick = ()=>{
      n -= 1;
      if(n <= 0){
        numEl.textContent = '1';
        // beri sedikit efek lalu redirect
        setTimeout(()=>{ window.location.href = 'login.html'; }, 700);
        clearInterval(iv);
        return;
      }
      numEl.textContent = String(n);
      // retrigger animasi pop
      numEl.style.animation = 'none';
      // Reflow untuk restart animation
      void numEl.offsetWidth;
      numEl.style.animation = '';
      numEl.style.animation = 'pop 600ms ease';
    };

    const iv = setInterval(tick, 1000);

    // Optional: kalau mau user skip, klik overlay untuk langsung ke login
    overlay.addEventListener('click', ()=>{ window.location.href = 'login.html'; });
  })();

  // Pause musik saat keluar
  window.addEventListener('pagehide', ()=> audio.pause());
</script>
</body>
</html>
